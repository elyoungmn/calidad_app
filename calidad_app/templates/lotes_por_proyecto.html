{% extends 'base.html' %}
{% block title %}Lotes · {{ proyecto.nombre }}{% endblock %}

{% block content %}
<div class="card p-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h5 mb-0">Lotes — {{ proyecto.nombre }}</h1>
    <div class="d-flex gap-2">
      <a href="{% url 'ver_proyectos' %}" class="btn btn-light btn-sm">Volver a Proyectos</a>
      {% if perms.calidad_app.add_lote %}
        <a href="{% url 'registrar_lote' proyecto.id %}" class="btn btn-primary btn-sm">Registrar Lote</a>
      {% endif %}
    </div>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} mb-3">{{ message }}</div>
    {% endfor %}
  {% endif %}

  {% if lotes %}
    <div class="list-group">
      {% for lote in lotes %}
        <div class="list-group-item py-3">
          <div class="d-flex justify-content-between align-items-start flex-wrap">
            <div class="me-3">
              <div class="fw-semibold">Lote {{ lote.id_lote }}</div>
              <div class="text-muted small">
                Fecha: {{ lote.fecha|date:"d/m/Y" }} · Responsable:
                {% if lote.subido_por %}
                  {{ lote.subido_por.get_full_name|default:lote.subido_por.username }}
                {% else %}
                  —
                {% endif %}
              </div>
            </div>
            <div class="mt-2 mt-sm-0 d-flex gap-2">
              <a href="{% url 'detalle_lote' lote.id %}" class="btn btn-outline-primary btn-sm">Detalle</a>
              <a href="{% url 'descargar_zip' lote.id %}" class="btn btn-secondary btn-sm">Descargar ZIP</a>
              {% if request.user.is_staff or request.user.is_superuser %}
                <a href="{% url 'editar_lote' lote.id %}" class="btn btn-outline-secondary btn-sm">Editar</a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center text-muted py-5">
      No hay lotes registrados en este proyecto.
      {% if perms.calidad_app.add_lote %}
        <div class="mt-3">
          <a href="{% url 'registrar_lote' proyecto.id %}" class="btn btn-primary btn-sm">Registrar Lote</a>
        </div>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}
