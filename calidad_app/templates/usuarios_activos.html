{% extends 'base.html' %}
{% block title %}Usuarios activos · Calidad{% endblock %}
{% block content %}
<div class="card p-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h5 mb-0">Usuarios activos</h1>
    <a href="{% url 'usuarios_pendientes' %}" class="btn btn-light btn-sm">Volver a pendientes</a>
  </div>

  {% if activos %}
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Usuario</th>
            <th>Nombre</th>
            <th>Email</th>
            <th>Rol</th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for u in activos %}
          <tr>
            <td class="fw-semibold">{{ u.username }}</td>
            <td>{{ u.get_full_name|default:"—" }}</td>
            <td>{{ u.email|default:"—" }}</td>
            <td>
              {% if u.is_superuser %}Superadmin{% elif u.is_staff %}Staff{% else %}
                {% if u.groups.all %}
                  {{ u.groups.all|join:", " }}
                {% else %}—{% endif %}
              {% endif %}
            </td>
            <td class="text-end">
              {% if not u.is_superuser and u.id != request.user.id %}
              <form method="post" action="{% url 'eliminar_usuario_activo' u.id %}" class="d-inline"
                    onsubmit="return confirm('¿Eliminar a {{ u.username }}? Esta acción no se puede deshacer.');">
                {% csrf_token %}
                <button class="btn btn-outline-danger btn-sm">Eliminar usuario</button>
              </form>
              {% else %}
              <span class="text-muted small">No eliminable</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="text-muted text-center py-5">No hay usuarios activos.</div>
  {% endif %}
</div>
{% endblock %}
